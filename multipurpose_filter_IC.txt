define h2ofilter -1993197973
define h2filter 15011598
define pollutantfilter 1915566057
define pollutantfiltermedium 63677771
define o2filter -721824748
define n2ofilter -1247674305
define n2filter 632853248
define co2filter 1635000764

alias 0check r2
alias 1check r3
alias occupied0 r14
alias occupied1 r13

main:
#safety check
lbn r15 HASH("StructurePipeAnalysizer") HASH("safetyanalyzer") Pressure 1
sgt r15 r15 50000
sbn HASH("StructureDigitalValve") HASH("safetyvalve") On r15
#coolant pump
lbn r15 HASH("StructurePipeAnalysizer") HASH("coolantanalyzer") Pressure 1
slt r15 r15 20000
sbn HASH("StructureConsoleLED5") HASH("debug") Setting r15
sbn HASH("StructureVolumePump") HASH("coolantpump") On r15
#fuel mix
sbn HASH("StructurePipeAnalysizer") HASH("fuelanalyzer") On 1
lbn r15 HASH("StructurePipeAnalysizer") HASH("fuelanalyzer") Pressure 1
slt r15 r15 3000
sbn HASH("StructureGasMixer") HASH("fuelmix") On r15
#pressure check
l r15 db PressureOutput
bgt r15 3000 pressurecheck
#reset filtration checks
move 0check 0
move 1check 0

#check filter type and occupant
ls occupied0 db 0 Occupied
breqz occupied0 2
ls r0 db 0 OccupantHash
ls occupied1 db 0 Occupied
or r15 occupied0 occupied1
beqz r15 main
breqz occupied1 2
ls r1 db 1 OccupantHash

filter0check:
move 0check 1
breqz occupied0 8
beq r0 h2ofilter h20
beq r0 h2filter h2
beq r0 pollutantfilter pollutant
beq r0 pollutantfiltermedium pollutant
beq r0 o2filter o2
beq r0 n2ofilter n2o
beq r0 n2filter n2
beq r0 co2filter co2

filter1check:
move 1check 1
breqz occupied1 main
beq r1 h2ofilter h20
beq r1 h2filter h2
beq r1 pollutantfilter pollutant
beq r0 pollutantfiltermedium pollutant
beq r1 o2filter o2
beq r1 n2ofilter n2o
beq r1 n2filter n2
beq r1 co2filter co2

h20:
l r15 db RatioWaterInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
h2:
l r15 db RatioVolatilesInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
pollutant:
l r15 db RatioPollutantInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
o2:
l r15 db RatioOxygenInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
n2o:
l r15 db RatioNitrousOxideInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
n2:
l r15 db RatioNitrogenInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check
co2:
l r15 db RatioCarbonDioxideInput
seqz r15 r15
seqz r15 r15
s db Mode r15
beq 1check 1 main
beq 0check 1 filter1check

#pressurcheck loop
pressurecheck:
s db Mode 0
j main
